[build]
  command = "npm run build"
  publish = "dist"
  # Use Ubuntu Noble 24.04 as recommended — Focal (20.04) is deprecated and will be removed.
  # Netlify recognizes these image keys: "ubuntu:20.04" (focal), "ubuntu:22.04" (jammy), "ubuntu:24.04" (noble).
  image = "ubuntu:24.04"

[build.environment]
  # Keep Node 20 LTS (works on ubuntu:24.04) — change if you need Node 22 or newer.
  NODE_VERSION = "20"
  NIXPACKS_NIX_VERSION = "2.19.3"

# Ensure critical static files are served directly (do not rewrite them to index.html)
[[redirects]]
  from = "/robots.txt"
  to = "/robots.txt"
  status = 200
  force = false

[[redirects]]
  from = "/sw.js"
  to = "/sw.js"
  status = 200
  force = false

[[redirects]]
  from = "/manifest.json"
  to = "/manifest.json"
  status = 200
  force = false

# Handle client-side routing (catch-all) — keep after the above rules so the static files are preserved
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
  force = true # Important for SPA routing

[dev]
  command = "npm run dev"
  framework = "vite"

[[headers]]
  for = "/*"
  [headers.values]
    Access-Control-Allow-Origin = "*"
